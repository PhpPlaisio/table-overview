<?xml version="1.0" encoding="UTF-8"?>
<project name="js-table-sorter-filter" default="build" basedir=".">
    <property name="BUILD_DIR" value="build"/>
    <property name="COMBINED_JS_FILE" value="set_table_sorter_filter.js"/>
    <property name="COMBINED_JS_FILE_MIN" value="set_table_sorter_filter-min.js"/>
    <target name="build" depends="prepare, copy_files, combine_js, minify_js">
    </target>
    <target name="prepare">
        <echo msg="Preparing files…"/>
        <if>
            <available file="${BUILD_DIR}" type="dir"/>
            <then>
                <echo msg="Removing old files…"/>
                <delete includeemptydirs="true" verbose="false" failonerror="true">
                    <fileset dir="${BUILD_DIR}">
                        <include name="**"/>
                    </fileset>
                </delete>
            </then>
            <else>
                <echo msg="Creating build dir…"/>
                <mkdir dir="${BUILD_DIR}"/>
            </else>
        </if>
    </target>
    <target name="copy_files">
        <echo msg="Copying main files…"/>
        <copy todir="${BUILD_DIR}" includeemptydirs="true" verbose="false">
            <fileset dir=".">
                <include name="**"/>
                <exclude name="build.xml"/>
                <exclude name="js/sources.txt"/>
            </fileset>
        </copy>
    </target>
    <target name="combine_js">
        <echo msg="Combining all js files into one…"/>
        <delete file="${BUILD_DIR}/${COMBINED_JS_FILE}"/>
        <append destFile="${BUILD_DIR}/${COMBINED_JS_FILE}">
            <filelist dir="${BUILD_DIR}/js" listfile="js/sources.txt"/>
        </append>
        <loadfile property="COMBINED_JS_FILE_OLD" file="${COMBINED_JS_FILE}"/>
        <loadfile property="COMBINED_JS_FILE_NEW" file="${BUILD_DIR}/${COMBINED_JS_FILE}"/>
        <if>
            <not>
                <equals arg1="${COMBINED_JS_FILE_OLD}" arg2="${COMBINED_JS_FILE_NEW}"></equals>
            </not>
            <then>
                <copy file="${BUILD_DIR}/${COMBINED_JS_FILE}" tofile="${COMBINED_JS_FILE}"/>
            </then>
        </if>
    </target>
    <target name="minify_js">
        <echo msg="Minifying JavaScript files…"/>
        <jsMin targetDir="${BUILD_DIR}">
            <fileset dir="${BUILD_DIR}">
                <include name="${COMBINED_JS_FILE}"/>
            </fileset>
        </jsMin>
        <loadfile property="COMBINED_JS_FILE_MIN_OLD" file="${COMBINED_JS_FILE_MIN}"/>
        <loadfile property="COMBINED_JS_FILE_MIN_NEW" file="${BUILD_DIR}/${COMBINED_JS_FILE_MIN}"/>
        <if>
            <not>
                <equals arg1="${COMBINED_JS_FILE_MIN_OLD}" arg2="${COMBINED_JS_FILE_MIN_NEW}"></equals>
            </not>
            <then>
                <copy file="${BUILD_DIR}/${COMBINED_JS_FILE_MIN}" tofile="${COMBINED_JS_FILE_MIN}"/>
            </then>
        </if>
    </target>
</project>
